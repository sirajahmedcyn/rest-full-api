<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= post.title %></title>
    <style>
        :root { --primary: #2563eb; --dark: #1e293b; --light: #f8fafc; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--light); color: #334155; margin: 0; line-height: 1.8; }
        
        /* Header */
        header { background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        nav { max-width: 1200px; margin: 0 auto; padding: 1rem 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); text-decoration: none; }
        .nav-links a { color: var(--dark); text-decoration: none; margin-left: 20px; font-weight: 500; transition: color 0.3s; }
        .nav-links a:hover { color: var(--primary); }
        .btn-login { background: var(--primary); color: var(--white) !important; padding: 8px 20px; border-radius: 50px; }
        
        .main-content { max-width: 740px; margin: 3rem auto; padding: 0 20px; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        
        h1 { font-family: 'Segoe UI', sans-serif; font-size: 2.5rem; color: var(--dark); margin-bottom: 0.5rem; line-height: 1.2; }
        .meta { font-family: 'Segoe UI', sans-serif; color: #64748b; font-size: 0.9rem; margin-bottom: 2rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        
        .post-image { width: 100%; max-height: 450px; object-fit: cover; border-radius: 8px; margin-bottom: 2rem; }
        .content { font-size: 1.15rem; color: #334155; }
        
        .tags-container { margin-top: 3rem; padding-top: 1rem; border-top: 1px solid #e2e8f0; }
        .tag-pill { background: #f1f5f9; color: #475569; padding: 5px 12px; border-radius: 20px; text-decoration: none; font-size: 0.85rem; margin-right: 8px; font-family: 'Segoe UI', sans-serif; }
        
        .comments-section { margin-top: 3rem; background: #f8fafc; padding: 2rem; border-radius: 12px; font-family: 'Segoe UI', sans-serif; }
        .comment { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .comment-header { font-weight: bold; color: var(--dark); margin-bottom: 0.25rem; }
        .comment-date { font-size: 0.75rem; color: #94a3b8; font-weight: normal; }
        
        textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; font-family: inherit; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        
        .delete-btn { background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">Rest Full Api Site</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/dashboard">Dashboard</a>
                <% if (!user) { %>
                    <a href="/login">Login</a>
                    <a href="/signup" class="btn-login">Get Started</a>
                <% } else { %>
                    <a href="/logout" class="btn-login">Logout</a>
                <% } %>
            </div>
        </nav>
    </header>

    <div class="main-content">
        <article>
            <header>
                <h1><%= post.title %></h1>
                <div class="meta">
                    <div>
                        <span><%= post.author.username %></span> in <span><%= post.category ? post.category.name : 'General' %></span>
                        <br>
                        <span style="font-size: 0.85em;"><%= new Date(post.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></span>
                    </div>
            <% if (user && post.author && post.author._id.toString() === user) { %>
                <form action="/api/posts/delete/<%= post._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this post?');">
                    <button type="submit" class="delete-btn">Delete Post</button>
                </form>
            <% } %>
                </div>
            </header>

            <% if (post.image) { %>
                <img src="<%= post.image %>" alt="<%= post.title %>" class="post-image">
            <% } %>

            <div class="content">
                <%- post.content.replace(/\n/g, '<br>') %>
            </div>

            <% if (post.tags && post.tags.length > 0) { %>
                <div class="tags-container">
                    <% post.tags.forEach(tag => { %>
                        <span class="tag-pill">#<%= tag.name %></span>
                    <% }) %>
                </div>
            <% } %>
        </article>

        <div class="comments-section">
            <h3>Discussion (<%= comments.length %>)</h3>
            
            <% if (user) { %>
                <form action="/api/posts/<%= post._id %>/comments" method="POST" style="margin-bottom: 2rem;">
                    <textarea name="content" rows="3" placeholder="What are your thoughts?" required></textarea>
                    <button type="submit">Post Comment</button>
                </form>
            <% } else { %>
                <p style="margin-bottom: 2rem;"><a href="/login" style="color: var(--primary);">Login</a> to join the discussion.</p>
            <% } %>

            <% comments.forEach(comment => { %>
                <div class="comment">
                    <div class="comment-header">
                        <%= comment.author.username %> 
                        <span class="comment-date"><%= new Date(comment.createdAt).toLocaleDateString() %></span>
                        <% if (user && (user === comment.author._id.toString() || (post.author && user === post.author._id.toString()))) { %>
                            <form action="/api/comments/delete/<%= comment._id %>" method="POST" style="float: right; margin-left: 10px;" onsubmit="return confirm('Delete this comment?');">
                                <button type="submit" class="delete-btn" style="padding: 2px 8px; font-size: 0.7rem;">Delete</button>
                            </form>
                        <% } %>
                    </div>
                    <div><%= comment.content %></div>
                </div>
            <% }) %>
        </div>
    </div>
</body>
</html>